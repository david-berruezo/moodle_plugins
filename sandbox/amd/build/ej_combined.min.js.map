{"version":3,"file":"ej_combined.min.js","sources":["../src/ej_combined.js"],"sourcesContent":["/**\n * Ejercicio 4: Combinando core/ajax + core/templates + core/notification\n *\n * Este es el PATRÓN REAL de desarrollo Moodle:\n * 1. El usuario interactúa con la página\n * 2. JS llama a un Web Service vía core/ajax\n * 3. La respuesta se renderiza con core/templates\n * 4. Se muestra una notificación con core/notification\n *\n * @module     local_sandbox/ej_combined\n * @copyright  2026 Tu Nombre\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(\n    ['core/ajax', 'core/templates', 'core/notification'],\n    function(Ajax, Templates, Notification) {\n        'use strict';\n\n        /** Contador de llamadas para el historial */\n        var callCount = 0;\n\n        /**\n         * Muestra/oculta el spinner de carga.\n         *\n         * @param {boolean} show\n         */\n        function toggleLoading(show) {\n            document.getElementById('combined-loading').style.display = show ? 'block' : 'none';\n        }\n\n        /**\n         * Añade una entrada al historial de llamadas.\n         *\n         * @param {string} name\n         * @param {string} timeofday\n         * @param {boolean} success\n         */\n        function addToHistory(name, timeofday, success) {\n            callCount++;\n            var list = document.getElementById('history-list');\n            var li = document.createElement('li');\n            li.className = 'list-group-item list-group-item-' + (success ? 'success' : 'danger');\n            li.textContent = '#' + callCount + ' — ' +\n                name + ' (' + timeofday + ') — ' +\n                (success ? 'OK' : 'ERROR') + ' — ' +\n                new Date().toLocaleTimeString();\n            // Insertar al principio\n            list.insertBefore(li, list.firstChild);\n        }\n\n        /**\n         * Flujo principal: AJAX → Template → Notification.\n         *\n         * @param {string} name\n         * @param {string} timeofday\n         */\n        function generateGreeting(name, timeofday) {\n\n            // Paso 1: Mostrar loading\n            toggleLoading(true);\n            document.getElementById('combined-output').innerHTML = '';\n\n            // Paso 2: Llamar al Web Service vía core/ajax\n            var promises = Ajax.call([\n                {\n                    methodname: 'local_sandbox_get_greeting',\n                    args: {\n                        name: name,\n                        timeofday: timeofday\n                    }\n                }\n            ]);\n\n            promises[0]\n                .then(function(response) {\n                    // Paso 3: Preparar el contexto para el template\n                    var cssClasses = {\n                        morning:   'border-warning',\n                        afternoon: 'border-success',\n                        evening:   'border-primary'\n                    };\n\n                    var context = {\n                        name: name,\n                        greeting: response.greeting,\n                        timestamp: response.timestamp,\n                        cssclass: cssClasses[timeofday] || 'border-secondary'\n                    };\n\n                    // Paso 4: Renderizar el template\n                    return Templates.renderForPromise('local_sandbox/greeting_card', context);\n                })\n                .then(function(result) {\n                    // Paso 5: Inyectar el HTML en la página\n                    toggleLoading(false);\n                    document.getElementById('combined-output').innerHTML = result.html;\n                    Templates.runTemplateJS(result.js);\n\n                    // Paso 6: Mostrar notificación de éxito\n                    Notification.addNotification({\n                        message: 'Greeting generated successfully for ' + name + '!',\n                        type: 'success'\n                    });\n\n                    // Paso 7: Añadir al historial\n                    addToHistory(name, timeofday, true);\n\n                    return result;\n                })\n                .catch(function(error) {\n                    toggleLoading(false);\n\n                    // Mostrar error con el sistema de notificaciones\n                    Notification.addNotification({\n                        message: 'Failed to generate greeting: ' + error.message,\n                        type: 'error'\n                    });\n\n                    addToHistory(name, timeofday, false);\n\n                    // También mostrar el diálogo modal de error (más detallado)\n                    Notification.exception(error);\n                });\n        }\n\n        /**\n         * Inicializa el módulo.\n         */\n        function init() {\n            document.getElementById('btn-combined').addEventListener('click', function() {\n                var name = document.getElementById('combined-name').value.trim();\n                var timeofday = document.getElementById('combined-time').value;\n\n                if (!name) {\n                    Notification.addNotification({\n                        message: 'Please enter a name.',\n                        type: 'warning'\n                    });\n                    return;\n                }\n\n                generateGreeting(name, timeofday);\n            });\n\n            window.console.log('[ej_combined] Módulo inicializado correctamente.');\n        }\n\n        return {\n            init: init\n        };\n    }\n);"],"names":["define","Ajax","Templates","Notification","callCount","toggleLoading","show","document","getElementById","style","display","addToHistory","name","timeofday","success","list","li","createElement","className","textContent","Date","toLocaleTimeString","insertBefore","firstChild","init","addEventListener","value","trim","innerHTML","call","methodname","args","then","response","context","greeting","timestamp","cssclass","morning","afternoon","evening","renderForPromise","result","html","runTemplateJS","js","addNotification","message","type","catch","error","exception","generateGreeting","window","console","log"],"mappings":";;;;;;;;;;;;;AAaAA,mCACI,CAAC,YAAa,iBAAkB,sBAChC,SAASC,KAAMC,UAAWC,kBAIlBC,UAAY,WAOPC,cAAcC,MACnBC,SAASC,eAAe,oBAAoBC,MAAMC,QAAUJ,KAAO,QAAU,gBAUxEK,aAAaC,KAAMC,UAAWC,SACnCV,gBACIW,KAAOR,SAASC,eAAe,gBAC/BQ,GAAKT,SAASU,cAAc,MAChCD,GAAGE,UAAY,oCAAsCJ,QAAU,UAAY,UAC3EE,GAAGG,YAAc,IAAMf,UAAY,MAC/BQ,KAAO,KAAOC,UAAY,QACzBC,QAAU,KAAO,SAAW,OAC7B,IAAIM,MAAOC,qBAEfN,KAAKO,aAAaN,GAAID,KAAKQ,kBAoGxB,CACHC,gBAnBAjB,SAASC,eAAe,gBAAgBiB,iBAAiB,SAAS,eAC1Db,KAAOL,SAASC,eAAe,iBAAiBkB,MAAMC,OACtDd,UAAYN,SAASC,eAAe,iBAAiBkB,MAEpDd,cA7EaA,KAAMC,WAG5BR,eAAc,GACdE,SAASC,eAAe,mBAAmBoB,UAAY,GAGxC3B,KAAK4B,KAAK,CACrB,CACIC,WAAY,6BACZC,KAAM,CACFnB,KAAMA,KACNC,UAAWA,cAKd,GACJmB,MAAK,SAASC,cAQPC,QAAU,CACVtB,KAAMA,KACNuB,SAAUF,SAASE,SACnBC,UAAWH,SAASG,UACpBC,SAVa,CACbC,QAAW,iBACXC,UAAW,iBACXC,QAAW,kBAOU3B,YAAc,2BAIhCX,UAAUuC,iBAAiB,8BAA+BP,YAEpEF,MAAK,SAASU,eAEXrC,eAAc,GACdE,SAASC,eAAe,mBAAmBoB,UAAYc,OAAOC,KAC9DzC,UAAU0C,cAAcF,OAAOG,IAG/B1C,aAAa2C,gBAAgB,CACzBC,QAAS,uCAAyCnC,KAAO,IACzDoC,KAAM,YAIVrC,aAAaC,KAAMC,WAAW,GAEvB6B,UAEVO,OAAM,SAASC,OACZ7C,eAAc,GAGdF,aAAa2C,gBAAgB,CACzBC,QAAS,gCAAkCG,MAAMH,QACjDC,KAAM,UAGVrC,aAAaC,KAAMC,WAAW,GAG9BV,aAAagD,UAAUD,UAoB3BE,CAAiBxC,KAAMC,WAPnBV,aAAa2C,gBAAgB,CACzBC,QAAS,uBACTC,KAAM,eAQlBK,OAAOC,QAAQC,IAAI"}