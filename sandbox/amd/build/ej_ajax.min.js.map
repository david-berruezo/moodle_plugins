{"version":3,"file":"ej_ajax.min.js","sources":["../src/ej_ajax.js"],"sourcesContent":["/**\n * Ejercicio 2: core/ajax\n *\n * @module     local_sandbox/ej_ajax\n * @copyright  2026 Tu Nombre\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(['core/ajax', 'core/notification'], function(Ajax, Notification) {\n    'use strict';\n\n    /**\n     * Inicializa los event listeners.\n     */\n    function init() {\n\n        // ---------------------------------------------------\n        // 1. Llamada simple a un Web Service\n        // ---------------------------------------------------\n\n        document.getElementById('btn-call-ws').addEventListener('click', function() {\n\n            var name = document.getElementById('input-name').value;\n            var timeofday = document.getElementById('select-time').value;\n\n            // Ajax.call() recibe un ARRAY de objetos.\n            // Cada objeto es una llamada a un Web Service.\n            // Devuelve un ARRAY de Promises (una por llamada).\n            var promises = Ajax.call([\n                {\n                    methodname: 'local_sandbox_get_greeting',  // Nombre del WS\n                    args: {                                     // Parámetros\n                        name: name,\n                        timeofday: timeofday\n                    }\n                }\n            ]);\n\n            // promises[0] corresponde a la primera (y única) llamada\n            promises[0]\n                .then(function(response) {\n                    // response contiene lo que devuelve execute_returns()\n                    var resultDiv = document.getElementById('ws-result');\n                    resultDiv.style.display = 'block';\n                    resultDiv.className = 'mt-3 alert alert-success';\n                    resultDiv.innerHTML =\n                        '<strong>Respuesta del servidor:</strong><br>' +\n                        'Greeting: ' + response.greeting + '<br>' +\n                        'Timestamp: ' + response.timestamp + '<br>' +\n                        'Lang: ' + response.lang;\n\n                    window.console.log('[ej_ajax] Respuesta:', response);\n                    return response;\n                })\n                .catch(function(error) {\n                    // Si algo falla, Notification.exception muestra el error\n                    Notification.exception(error);\n                });\n        });\n\n        // ---------------------------------------------------\n        // 2. Llamada batch (múltiples WS en una sola petición HTTP)\n        // ---------------------------------------------------\n\n        document.getElementById('btn-call-batch').addEventListener('click', function() {\n\n            // Ajax.call() con MÚLTIPLES objetos = 1 sola petición HTTP\n            // Esto es mucho más eficiente que hacer 3 llamadas separadas\n            var promises = Ajax.call([\n                {\n                    methodname: 'local_sandbox_get_greeting',\n                    args: { name: 'Alice', timeofday: 'morning' }\n                },\n                {\n                    methodname: 'local_sandbox_get_greeting',\n                    args: { name: 'Bob', timeofday: 'afternoon' }\n                },\n                {\n                    methodname: 'local_sandbox_get_greeting',\n                    args: { name: 'Charlie', timeofday: 'evening' }\n                }\n            ]);\n\n            // Usar Promise.all para esperar a las 3 respuestas\n            Promise.all(promises)\n                .then(function(results) {\n                    var resultDiv = document.getElementById('batch-result');\n                    resultDiv.style.display = 'block';\n                    resultDiv.className = 'mt-3 alert alert-info';\n\n                    var html = '<strong>Resultados del batch (3 llamadas, 1 petición HTTP):</strong><br>';\n                    results.forEach(function(r, index) {\n                        html += (index + 1) + '. ' + r.greeting + '<br>';\n                    });\n                    resultDiv.innerHTML = html;\n\n                    return results;\n                })\n                .catch(function(error) {\n                    Notification.exception(error);\n                });\n        });\n\n        // ---------------------------------------------------\n        // 3. Manejo de errores\n        // ---------------------------------------------------\n\n        document.getElementById('btn-call-error').addEventListener('click', function() {\n\n            var promises = Ajax.call([\n                {\n                    methodname: 'local_sandbox_funcion_que_no_existe',\n                    args: {}\n                }\n            ]);\n\n            promises[0]\n                .then(function(response) {\n                    // No debería llegar aquí\n                    window.console.log('Respuesta inesperada:', response);\n                    return response;\n                })\n                .catch(function(error) {\n                    // Mostramos el error de dos formas:\n\n                    // 1. Con Notification.exception (diálogo modal de Moodle)\n                    Notification.exception(error);\n\n                    // 2. Manualmente en nuestro div\n                    var resultDiv = document.getElementById('error-result');\n                    resultDiv.style.display = 'block';\n                    resultDiv.className = 'mt-3 alert alert-danger';\n                    resultDiv.innerHTML =\n                        '<strong>Error capturado:</strong><br>' +\n                        'Mensaje: ' + error.message + '<br>' +\n                        'Error code: ' + (error.errorcode || 'N/A');\n                });\n        });\n\n        window.console.log('[ej_ajax] Módulo inicializado correctamente.');\n    }\n\n    return {\n        init: init\n    };\n});"],"names":["define","Ajax","Notification","init","document","getElementById","addEventListener","name","value","timeofday","call","methodname","args","then","response","resultDiv","style","display","className","innerHTML","greeting","timestamp","lang","window","console","log","catch","error","exception","promises","Promise","all","results","html","forEach","r","index","message","errorcode"],"mappings":";;;;;;;AAOAA,+BAAO,CAAC,YAAa,sBAAsB,SAASC,KAAMC,oBAsI/C,CACHC,gBA3HAC,SAASC,eAAe,eAAeC,iBAAiB,SAAS,eAEzDC,KAAOH,SAASC,eAAe,cAAcG,MAC7CC,UAAYL,SAASC,eAAe,eAAeG,MAKxCP,KAAKS,KAAK,CACrB,CACIC,WAAY,6BACZC,KAAM,CACFL,KAAMA,KACNE,UAAWA,cAMd,GACJI,MAAK,SAASC,cAEPC,UAAYX,SAASC,eAAe,oBACxCU,UAAUC,MAAMC,QAAU,QAC1BF,UAAUG,UAAY,2BACtBH,UAAUI,UACN,yDACeL,SAASM,SADxB,kBAEgBN,SAASO,UAFzB,aAGWP,SAASQ,KAExBC,OAAOC,QAAQC,IAAI,uBAAwBX,UACpCA,YAEVY,OAAM,SAASC,OAEZzB,aAAa0B,UAAUD,aAQnCvB,SAASC,eAAe,kBAAkBC,iBAAiB,SAAS,eAI5DuB,SAAW5B,KAAKS,KAAK,CACrB,CACIC,WAAY,6BACZC,KAAM,CAAEL,KAAM,QAASE,UAAW,YAEtC,CACIE,WAAY,6BACZC,KAAM,CAAEL,KAAM,MAAOE,UAAW,cAEpC,CACIE,WAAY,6BACZC,KAAM,CAAEL,KAAM,UAAWE,UAAW,cAK5CqB,QAAQC,IAAIF,UACPhB,MAAK,SAASmB,aACPjB,UAAYX,SAASC,eAAe,gBACxCU,UAAUC,MAAMC,QAAU,QAC1BF,UAAUG,UAAY,4BAElBe,KAAO,kFACXD,QAAQE,SAAQ,SAASC,EAAGC,OACxBH,MAASG,MAAQ,EAAK,KAAOD,EAAEf,SAAW,UAE9CL,UAAUI,UAAYc,KAEfD,WAEVN,OAAM,SAASC,OACZzB,aAAa0B,UAAUD,aAQnCvB,SAASC,eAAe,kBAAkBC,iBAAiB,SAAS,WAEjDL,KAAKS,KAAK,CACrB,CACIC,WAAY,sCACZC,KAAM,MAIL,GACJC,MAAK,SAASC,iBAEXS,OAAOC,QAAQC,IAAI,wBAAyBX,UACrCA,YAEVY,OAAM,SAASC,OAIZzB,aAAa0B,UAAUD,WAGnBZ,UAAYX,SAASC,eAAe,gBACxCU,UAAUC,MAAMC,QAAU,QAC1BF,UAAUG,UAAY,0BACtBH,UAAUI,UACN,iDACcQ,MAAMU,QADpB,oBAEkBV,MAAMW,WAAa,aAIrDf,OAAOC,QAAQC,IAAI"}